---
title: "DEA Analysis"
author: "Brooke Cummins"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r, include = FALSE}
library(tidyverse)
library(fixest)
library(purrr)
library(vtable)
library(estimatr)
library(lubridate)
library(Ecdat)
library(purrr)
library(corrplot)
library(gridExtra)
library(janitor)
library(knitr)
library(GGally)
library(scales)
library(patchwork)
library(DataExplorer)
```

```{r}
source("../Code/Data Exploration Code.R")
```

```{r}
# Check descriptive stats of the data
sumtable(clean_df)
```


***Comments***

+ There are a lot of variables in this data set so I'll only go over the ones of interest I'll be focusing on in this analysis

    - asasdfasdfa
    - asasdfasdfa



# Base EDA Step 2: Uni-variate graphical EDA

## Quantitative Variables
```{r}

hist1 <- ggplot(data = clean_df, mapping = aes(x= index)) + 
  geom_histogram() 

hist2 <- ggplot(data = clean_df, mapping = aes(x = earnings)) + 
  geom_histogram()

hist3 <- ggplot(data = clean_df, mapping = aes(x= ACTCMMID)) + 
  geom_histogram() 

hist4 <- ggplot(data = clean_df, mapping = aes(x = SAT_AVG)) + 
  geom_histogram()

```

```{r}
(hist1 + hist2) / 
  (hist3 + hist4)
```


**Comments**

  + asdfasdf
  + asdfasdf 

## Categorical Variables

```{r}

bar1 <- ggplot(data = clean_df, mapping = aes(x = post_scorecard)) +
  geom_bar() 

bar2 <- ggplot(data = clean_df, mapping = aes(x = high_earner)) +
  geom_bar()

bar3 <- ggplot(data = clean_df, mapping = aes(x = PBI)) +
  geom_bar()

bar4 <- ggplot(data = clean_df, mapping = aes(x = HSI)) +
  geom_bar()

bar5 <- ggplot(data = clean_df, mapping = aes(x = MENONLY)) +
  geom_bar()

bar6 <- ggplot(data = clean_df, mapping = aes(x = WOMENONLY)) +
  geom_bar()
```


```{r}
(bar1 + bar2) / 
  (bar3 + bar4) /
  (bar5 + bar6)
```

**Comments**

  + asdfasdf
  + asdfasdf 



# Base EDA Step 3 & 4: Multi-variate non-graphical, multi-variate graphical

```{r message=FALSE, warning=FALSE}
clean_df %>% 
  subset(select = c(index, earnings, post_scorecard, high_earner, PBI, HSI, MENONLY, WOMENONLY, ACTCMMID, SAT_AVG)) %>% 
  na.omit() %>% 
  plot_correlation()
```


```{r message=FALSE, warning=FALSE}
clean_df %>% 
  subset(select = c(index, earnings, post_scorecard, high_earner, PBI, HSI, MENONLY, WOMENONLY, ACTCMMID, SAT_AVG)) %>% 
  na.omit() %>% 
  ggpairs()
```


**Comments**

  + asdfasdf
  + asdfasdf 



# Detailed EDA - questions raised in Base EDA
## Index and earnings


```{r message=FALSE, warning=FALSE}

ggplot(clean_df, aes(x = earnings, y = index)) + geom_point() 


```


**Comments**

  + Hard to not immediately point out the shape of this beauty...


## Index values before and after scorecard


```{r message=FALSE, warning=FALSE}

clean_df %>% group_by(post_scorecard) %>% 
  summarise(avg_index = mean(index, na.rm = TRUE)) %>% 
  ggplot(mapping = aes(x = post_scorecard, y = avg_index)) +
  geom_col() 

```


**Comments**

  + Index scores went down after the scorecard was created so we need to control for it


## Earnings and Index with SAT


```{r message=FALSE, warning=FALSE}
earn_sat <- ggplot(clean_df, aes(x = SAT_AVG, y = earnings)) + geom_point() 

index_sat <- ggplot(clean_df, aes(x = SAT_AVG, y = index)) + geom_point() 


(earn_sat + index_sat)
```


**Comments**

  + SAT and earnings is super interesting!



# Modeling
## Model 1

```{r}

mod_1 <- feols(index ~ post_scorecard + earnings + SAT_AVG + monthorweek,data = clean_df)
etable(mod_1)

```

***Comment***

  + We probably want an interaction term with scorecard and earnings but I wanted to get a base read


## Model 2

```{r}

mod_2 <- feols(index ~ post_scorecard + earnings + I(post_scorecard*earnings) + SAT_AVG + monthorweek,data = clean_df)
etable(mod_2)

```

***Comment***

  + I really like this model but lets see if SAT is helping us


```{r}
wald(mod_2, 'SAT_AVG')
```

  + let's try without it!


## Model 3

```{r}

mod_3 <- feols(index ~ post_scorecard + earnings + I(post_scorecard*earnings) + monthorweek,data = clean_df)
etable(mod_3)

```

***Comment***

  + We have our model!


# Summary of Findings

  + asdfasdf
  + asdfasdf 



# Create any visuals needed for write up
```{r}

``` 




